<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.model.dao.AptDao">
     
     <select id="getAptsOnMap" resultType="com.ssafy.model.dto.AptInfo">
    	SELECT apt_seq, apt_nm, build_year, latitude, longitude
	    FROM houseinfos
	    <where>
	      latitude  BETWEEN #{swLat}  AND #{neLat}
	      AND   longitude BETWEEN #{swLng}  AND #{neLng}
	      <if test="keyword != null and keyword.trim() != ''">
	        AND apt_nm LIKE CONCAT('%', #{keyword}, '%')
	      </if>
	    </where>
	</select>
	<!-- 
	<select id="getAptsOnMap" resultType="com.ssafy.model.dto.AptInfo">
    	SELECT 
		    hi.apt_seq,
		    hi.apt_nm,
		    hi.build_year,
		    hi.latitude,
		    hi.longitude
		FROM (
		    
		    SELECT DISTINCT apt_seq
		    FROM (
		        SELECT apt_seq, deal_year, deal_month, deal_day
		        FROM housedeals
		        IGNORE INDEX (idx_date_aptseq)   
		        ORDER BY deal_year DESC, deal_month DESC, deal_day DESC
		    ) AS sorted
		    LIMIT 100
		) AS top_apt
		JOIN houseinfos AS hi
		  ON hi.apt_seq = top_apt.apt_seq;
	</select>
	 -->

    <select id="getAptInfo" resultType="com.ssafy.model.dto.AptInfo">
    	select apt_seq, apt_nm, build_year, latitude, longitude
    	from houseinfos
    	where apt_seq = #{apt_seq}
    </select>

<!-- 
    <select id="getAptDealList" resultType="com.ssafy.model.dto.AptDeal">
	    SELECT deal_year, deal_month, deal_day, deal_amount, floor, exclu_use_ar
	FROM housedeals
	WHERE apt_seq = #{apt_seq}
	ORDER BY deal_year DESC, deal_month DESC, deal_day DESC
	LIMIT #{page}, #{per_page}
    </select>
     -->
    <select id="getAptDealList" resultType="com.ssafy.model.dto.AptDeal">
	    SELECT deal_year, deal_month, deal_day, deal_amount, floor, exclu_use_ar, apt_dong
	FROM housedeals
	WHERE apt_seq = #{apt_seq}
	ORDER BY deal_year DESC, deal_month DESC, deal_day DESC
	limit #{per_page} 
    </select>
    
</mapper>
